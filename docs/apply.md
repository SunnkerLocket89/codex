# Codex Apply Command

The `codex apply` command allows you to apply diffs generated by Codex agent tasks directly to your local working tree. This is useful when working with Codex tasks in ChatGPT and wanting to apply the changes locally.

## Usage

```shell
codex apply <task_id>
```

or using the short alias:

```shell
codex a <task_id>
```

### Arguments

- `<task_id>` - The task ID from a Codex agent task in ChatGPT. This is typically a UUID that identifies a specific task.

### Options

The command supports all standard configuration overrides via the `-c` flag:

```shell
codex apply <task_id> -c chatgpt_base_url="https://custom.chatgpt.com/backend-api/"
```

## How it Works

When you run `codex apply`:

1. The command authenticates using your ChatGPT credentials from `~/.codex/auth.json`
2. It fetches the task details from the ChatGPT backend API
3. It extracts the diff from the latest diff task turn
4. It applies the diff to your local repository using `git apply`

## Prerequisites

- You must be logged in with ChatGPT credentials (`codex login`)
- You must have a valid task ID from a Codex agent task
- Your current working directory should be a git repository
- The diff should be compatible with your current repository state

## Examples

### Basic usage

Apply a diff from a Codex agent task:

```shell
codex apply 12345678-1234-1234-1234-123456789abc
```

### Using a custom ChatGPT base URL

If your organization uses a custom ChatGPT deployment:

```shell
codex apply 12345678-1234-1234-1234-123456789abc \
  -c chatgpt_base_url="https://custom.chatgpt.com/backend-api/"
```

### Using with a specific profile

Apply a diff using a specific configuration profile:

```shell
codex apply 12345678-1234-1234-1234-123456789abc -p production
```

## Error Handling

The command will fail with an error if:

- You're not logged in with ChatGPT credentials
- The task ID doesn't exist or you don't have access to it
- The task doesn't contain a diff
- The diff conflicts with your local changes
- The diff cannot be applied cleanly

### Common Issues

#### "ChatGPT token not available"

Make sure you're logged in:

```shell
codex login
```

Then select "Sign in with ChatGPT" when prompted.

#### "No diff turn found"

The task may not have generated a diff yet, or the task type doesn't produce diffs.

#### Git apply failed

The diff may conflict with your current code. Common resolutions:

- Make sure you're on the correct branch
- Commit or stash your local changes
- Ensure the base commit matches what the diff expects

## Configuration

The ChatGPT integration can be configured in `~/.codex/config.toml`:

```toml
# Base URL for ChatGPT backend API (default: "https://chatgpt.com/backend-api/")
chatgpt_base_url = "https://chatgpt.com/backend-api/"

# Force users to log in with ChatGPT (optional)
forced_login_method = "chatgpt"

# Restrict to a specific ChatGPT workspace (optional)
forced_chatgpt_workspace_id = "00000000-0000-0000-0000-000000000000"
```

For more configuration options, see [Configuration](./config.md).

## See Also

- [Authentication](./authentication.md) - Learn about ChatGPT login
- [Configuration](./config.md) - Full configuration reference
- [Getting Started](./getting-started.md) - General Codex CLI usage
